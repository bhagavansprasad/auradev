- Need to export path of the file which contains aws login credentials
export AWS_CREDENTIAL_FILE=/home/bhagavan/aws/rootkey.csv
 
- Running commands
example :
python get_aws_billing.py -d <dd>/<mm>/<yyyy>

python get_aws_billing.py -d yesterday
python get_aws_billing.py -d 16/11/2012 --db aws.db

- To print regions
echo 'import boto.ec2; print boto.ec2.regions()' | python
  
CLI

- Volumes
aws ec2 describe-volumes 
aws ec2 describe-volumes --query 'Volumes[0]'
aws ec2 describe-volumes --query 'Volumes[0].{ID:VolumeId}'
aws ec2 describe-volumes --query 'Volumes[*].{ID:VolumeId}'
aws ec2 describe-volumes --query 'Volumes[*].[VolumeId, Attachments[0].InstanceId, AvailabilityZone, Size]'
aws ec2 describe-volumes --query 'Volumes[?AvailabilityZone==`ap-south-1a`]'
aws ec2 describe-volumes --query 'Volumes[*].[VolumeId, Attachments[0].InstanceId, AvailabilityZone, Size, FakeKey]'
aws ec2 describe-volumes --output table
 aws ec2 describe-volumes --query 'Volumes[*].{ID:VolumeId,InstanceId:Attachments[0].InstanceId,AZ:AvailabilityZone,Size:Size}' --output table

- Instances
aws ec2 describe-instances --query 'Reservations[*].Instances[*].[Placement.AvailabilityZone, State.Name, InstanceId]' --output text
aws ec2 describe-instances --query 'Reservations[*].Instances[*].[Placement.AvailabilityZone, State.Name, InstanceId]' --output text | grep ap-south-1a | grep running | awk '{print $3}'
aws ec2 describe-instances --query 'Reservations[*].Instances[*].[State.Name, InstanceId]' --output text | grep stopped | awk '{print $2}'
aws ec2 describe-instances --query 'Reservations[*].Instances[*].[State.Name, InstanceId]' --output text | grep stopped | awk '{print $2}' | while read line; do aws ec2 modify-instance-attribute --instance-id $line --instance-type '{"Value": "m1.medium"}'; done

 aws cloudwatch get-metric-statistics --namespace AWS/EC2 --metric-name CPUUtilization --dimensions Name=InstanceId,Value=i-0e9e316a5b3d215cb --statistics Average --start-time `date -u '+%FT%TZ' -d '10 mins ago'` --end-time `date -u '+%FT%TZ'` --period 60

aws cloudwatch get-metric-statistics --metric-name CPUUtilization --start-time 2017-11-10T23:18:00 --end-time 2017-11-17T23:18:00 --period 3600 --namespace AWS/EC2 --statistics Maximum --dimensions Name=i-0e9e316a5b3d215cb,Value=AuraAWSInstance
aws cloudwatch get-metric-statistics --metric-name CPUUtilization --start-time 2017-11-15T23:18:00 --end-time 2017-11-17T23:18:00 --period 3600 --namespace AWS/EC2 --statistics Maximum --dimensions Name=i-0e9e316a5b3d215cb,Value=AuraAWSInstance

aws cloudwatch list-metrics --namespace AWS/EC2 --dimensions Name=InstanceType,Value=t1.micro
aws cloudwatch get-metric-statistics \
--namespace AWS/EC2 \
--metric-name CPUUtilization \
--dimensions Name=InstanceId,Value=i-xxx \
--statistics Average \
--start-time `date -u '+%FT%TZ' -d '10 mins ago'` \
--end-time `date -u '+%FT%TZ'` \
--period 60

aws cloudwatch get-metric-statistics \
--namespace AWS/EC2 \
--metric-name CPUUtilization \
--dimensions Name=InstanceId,Value=i-xxx \
--statistics Average \
--start-time `date -u '+%FT%TZ' -d '10 mins ago'` \
--end-time `date -u '+%FT%TZ'` \
--period 60 | jq '.Datapoints[0] | .Average'




